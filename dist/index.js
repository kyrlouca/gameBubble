"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),bbShoot=window.bbShoot||{};!function(e){e.Bubble=function(){function e(t,r,o){_classCallCheck(this,e);var n=0;this.isFire=!1,this.row=t,this.col=r,this.lowZ=o;var i=Math.floor(4*Math.random());this.sprite=document.createElement("div"),this.sprite.classList.add("bubble"),this.sprite.objBubble=this,this.changeColor(i),this.makeNormal(),this.nextStatus=function(){n+=1,n%=4,this.changeColor(n)}}return _createClass(e,[{key:"makeFire",value:function(){this.isFire=!0,this.changeShape(2)}},{key:"makeNormal",value:function(){this.isFire=!1,this.changeShape(0)}},{key:"getSprite",value:function(){return this.sprite}},{key:"changeColor",value:function(e){e%=4,this.color=e,this.sprite.style.backgroundPositionY=50*e+"px"}},{key:"changeShape",value:function(e){this.sprite.style.backgroundPositionX=50*e+"px"}}]),e}()}(bbShoot);var bbShoot=window.bbShoot||{};!function(e){e.drawSprite=function(e,t){t&&(e.left=t.left,e.top=t.top);var r=document.querySelector("#board"),o=e.getSprite();o.style.top=e.top+"px",o.style.left=e.left+"px",e.lowZ&&o.classList.add("belowBubble"),r.appendChild(o)},e.constants=function(){return{bubbleSize:50,rowSize:3,colSize:7,boardHeight:function(){var e=document.querySelector("#board");return parseInt(getComputedStyle(e).height)}(),boardWidth:function(){var e=document.querySelector("#board");return parseInt(getComputedStyle(e).width)}()}}()}(bbShoot);var bbShoot=window.bbShoot||{};!function(e){var t=function(){function e(){_classCallCheck(this,e),this.score=0,this.level=0,this.sprite=document.querySelector("#infoSide")}return _createClass(e,[{key:"start",value:function(e){this.score=0,this.level=0,this.sprite.querySelector("#playerName").innerText=e,this.sprite.querySelector("#score").innerText="00",this.sprite.querySelector("#level").innerText="0",this.sprite.querySelector("#playerNameIn").value="",this.sprite.addEventListener("sbScoreEvt",this.updateScore.bind(this)),this.sprite.addEventListener("sbLevelEvt",this.updateLevel.bind(this))}},{key:"stop",value:function(){}},{key:"updateScore",value:function(e){this.score=e.detail.val;var t=this.score.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),r=this.sprite.querySelector("#score");r.innerText=t}},{key:"updateLevel",value:function(e){this.level=e.detail.val;var t=this.sprite.querySelector("#level");t.innerText=this.level}}]),e}();e.scoreBoard=new t}(bbShoot);var bbShoot=window.bbShoot||{};!function(e){var t=function(){function e(){_classCallCheck(this,e),this.players={},this.sprite=document.querySelector("#historySide"),this.sprite.querySelector("#historyList").innerHTML=""}return _createClass(e,[{key:"start",value:function(e){this.sprite.addEventListener("hpUpdateEvt",this.updateHistory.bind(this))}},{key:"stop",value:function(){}},{key:"updateHistory",value:function(e){function t(e){var t,r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],o=arguments.length<=2||void 0===arguments[2]?" ":arguments[2],n="";if("number"==typeof e)n=e.toLocaleString("en-US",{minimumIntegerDigits:r,useGrouping:!1});else for(t=0;t<r;t++)n+=e[t]||o;return n}var r,o,n=(t("ab",4,"+"),e.detail.players),i=function(e,t){return e.score>t.score?-1:1};n.sort(i),window.console.log(n.map(function(e){return e.name}).toString()),o=this.sprite.querySelector("#historyList"),o.innerHTML="";var s=!0,a=!1,l=void 0;try{for(var u,c=n[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){r=u.value,window.console.log(r.name);var h=document.createElement("p");h.classList.add("hpAll","hpLeft"),h.appendChild(document.createTextNode(r.name));var b=document.createElement("p");b.classList.add("hpAll","hpRight"),b.appendChild(document.createTextNode(""+r.score));var d=document.createElement("li");d.appendChild(h),d.appendChild(b),o.appendChild(d)}}catch(p){a=!0,l=p}finally{try{!s&&c["return"]&&c["return"]()}finally{if(a)throw l}}}}]),e}();e.historyPlayers=new t}(bbShoot);var bbShoot=window.bbShoot||{};!function(e){var t=function(){function e(){_classCallCheck(this,e),this.rows=[],this.boardElement=document.querySelector("#board"),this.score=0,this.fireStack=[]}return _createClass(e,[{key:"createBubble",value:function(e,t){var r=new bbShoot.Bubble(e,t);return this.rows[e]||(this.rows[e]=[]),this.row=0,this.col=0,this.rows[e].push(r),r}},{key:"pinBubble",value:function(e){var t,r,o=bbShoot.constants.boardHeight,n=bbShoot.constants.boardWidth,i=bbShoot.constants.bubbleSize,s=this.createBubble(0,0);return t=e.top-i/2,t=Math.max(t,0),t=Math.min(t,o-i),r=e.left-i/2,r=Math.max(r,0),r=Math.min(r,n-i),e={left:r,top:t},bbShoot.drawSprite(s,e),this.rearrangeBubble(s,e),s.sprite.innerText="x:"+e.left+" y:"+e.top,s}},{key:"removeBubble",value:function(e){this.sprite.removeChild(e.sprite);var t=this.rows[e.row],r=t.indexOf(e);r!==-1&&this.rows[e.row].splice(r,1)}},{key:"findBubbleRow",value:function(e){var t=bbShoot.constants.bubbleSize,r=e.getSprite(),o=parseInt(getComputedStyle(r).top)+t/2,n=parseInt(getComputedStyle(r).left)+t/2,i=Math.floor(o/t),s=Math.floor(n/t);return{row:i,col:s}}},{key:"getBubbleCenter",value:function(e){var t=bbShoot.constants.bubbleSize,r=e.getSprite(),o=parseInt(getComputedStyle(r).top)+t/2,n=parseInt(getComputedStyle(r).left)+t/2;return{top:o,left:n}}},{key:"setBubbleRow",value:function(e,t){var r=(e.row,this.rows[e.row].indexOf(e));return r!==-1&&(this.rows[e.row].splice(r,1),this.rows[t]||(this.rows[t]=[]),e.row=t,this.rows[t].push(e)),e}},{key:"rearrangeBubble",value:function(e,t){var r=(e.row,this.findBubbleRow(e)),o=this.rows[e.row].indexOf(e);return o!==-1&&(this.rows[e.row].splice(o,1),this.rows[r]||(this.rows[r]=[]),e.row=r,this.rows[r].push(e)),e}},{key:"createFireBubble",value:function(){var e=bbShoot.constants.bubbleSize,t=Math.ceil(bbShoot.constants.boardHeight/e)-1,r=this.createBubble(t,0);return r.top=t*e,r.left=bbShoot.constants.boardWidth/2-e/2,r.makeFire(),r}},{key:"createBubbles",value:function(e,t){var r,o,n,i,s,a,l;s=bbShoot.constants.bubbleSize,n=bbShoot.constants.boardHeight,i=bbShoot.constants.boardWidth;for(var u=0;u<e;u++)for(var c=0;c<t;c++)a=c*s,l=u%2?0:s/2,o={top:u*s,left:l+c*s},r=this.createBubble(u,c),bbShoot.drawSprite(r,o)}},{key:"addPoints",value:function(e){this.score+=e}},{key:"getArray",value:function(){function e(e){return e.map(function(e){return e.row}).join("-")}var t="";return this.rows.forEach(function(r,o){t=t+"row:"+o+" "+e(r)+"\n"}),t}},{key:"clearBoard",value:function(){var e=this;this.score=0,this.rows.forEach(function(t,r){t.forEach(function(t){e.boardElement.removeChild(t.sprite)})}),this.rows=[]}},{key:"stackFire",value:function(e,t){this.fireStack.push({bubble:e,point:t})}},{key:"sprite",get:function(){return this.boardElement}}]),e}();e.board||(e.board=new t)}(bbShoot);var bbShoot=window.bbShoot||{};!function(e){function t(e,t){var r=e.sprite,o=t.sprite,n=bbShoot.constants.bubbleSize;if(e===t)return!1;var i=parseInt(getComputedStyle(r).top)+n/2,s=parseInt(getComputedStyle(r).left)+n/2,a=parseInt(getComputedStyle(o).top)+n/2,l=parseInt(getComputedStyle(o).left)+n/2,u=Math.sqrt(Math.pow(i-a,2)+Math.pow(s-l,2));return u<n}function r(e){var t=bbShoot.constants.bubbleSize,r=bbShoot.constants.boardWidth/2-t/2,o=bbShoot.constants.boardHeight-t,n=e.sprite.offsetTop,i=e.sprite.offsetLeft,s=Math.sqrt(Math.pow(r-i,2)+Math.pow(o-n,2));return s<t}function o(e){var r,o,n,i=b.findBubbleRow(e),s=[];for(o=i.row;o>=i.row-1;o--){r=b.rows[o]||[];var a=!0,l=!1,u=void 0;try{for(var c,h=r[Symbol.iterator]();!(a=(c=h.next()).done);a=!0)if(n=c.value,e!==n&&t(e,n))if(n.isFire);else s.push(n)}catch(d){l=!0,u=d}finally{try{!a&&h["return"]&&h["return"]()}finally{if(l)throw u}}}return s}function n(e){e.preventDefault()}function i(e){e.preventDefault();var t;if("board"===e.target.id)if(2===e.button)e.preventDefault(),window.alert("right");else if(0===e.button){t=b.fireBubble;var r={left:e.offsetX,top:e.offsetY};t&&m(t,r),t=b.createFireBubble(),b.fireBubble=t,bbShoot.drawSprite(t)}}function s(){var e,t,r,o;t=Math.floor(Math.floor(Math.random()*bbShoot.constants.boardHeight*4/5)),e=Math.floor(Math.floor(Math.random()*bbShoot.constants.boardWidth)),r={top:t,left:e},o=b.createFireBubble(),bbShoot.drawSprite(o),m(o,r)}function a(){var e,t={};t.level=Math.min(d.level+1,d.levels.length-1),d.setLevel(t.level),l(),e=new CustomEvent("sbLevelEvt",{detail:{val:t.level}}),bbShoot.scoreBoard.sprite.dispatchEvent(e),window.clearTimeout(f),f=window.setTimeout(a,d.changeLevelFreq)}function l(){var e=d.gSettings.fireInterval;window.clearInterval(p),p=window.setInterval(s,e)}function u(e){e.sprite.classList.add("bobble")}function c(){var t=document.querySelector("#playerNameIn"),r=t.value;return t.value?(b=bbShoot.board,e.game||(d=new S,e.game=d),bbShoot.scoreBoard.start(r),bbShoot.historyPlayers.start(),void d.startGame(r)):(document.querySelector("#messageArea").innerText="Enter your name first!",void t.focus())}function h(){}var b,d,p,f,v=[],S=function(){function e(){_classCallCheck(this,e);var t,r=this;this.score=0,this.levels=[{fireInterval:2e3,steps:50},{fireInterval:1500,steps:40},{fireInterval:1e3,steps:30},{fireInterval:400,steps:25},{fireInterval:100,steps:30}],this.klevels=[{fireInterval:2500,steps:50},{fireInterval:2e3,steps:45},{fireInterval:1500,steps:40},{fireInterval:1200,steps:40},{fireInterval:200,steps:20}],this.name="anonumous",this.cBoard=bbShoot.board,this.isOn=!1,this.setLevel=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return t=e,r.levels[e]},this.getLevel=function(){if(null===t)throw new Error("_level is NaN");return t}}return _createClass(e,[{key:"startGame",value:function(e){var t;this.player=e,this.isOn=!0,this.score=0,this.cBoard.clearBoard(),this.cBoard.createBubbles(bbShoot.constants.rowSize,bbShoot.constants.colSize),this.setLevel(-1),this.changeLevelFreq=2e4,t=this.cBoard.createFireBubble(),this.cBoard.fireBubble=t,bbShoot.drawSprite(t),this.cBoard.sprite.addEventListener("mousedown",i),this.cBoard.sprite.addEventListener("dblclick",n),document.querySelector("#messageArea").innerText="",a()}},{key:"stopGame",value:function(){var e;this.cBoard.sprite.removeEventListener("mousedown",i),this.cBoard.sprite.removeEventListener("dblclick",n),clearInterval(p),y("resources//audio//glassbreak.wav"),this.isOn&&(v.push({name:d.player,score:d.score}),e=new CustomEvent("hpUpdateEvt",{detail:{players:v}}),bbShoot.historyPlayers.sprite.dispatchEvent(e),this.isOn=!1)}},{key:"level",get:function(){return this.getLevel()}},{key:"gSettings",get:function(){return this.player.indexOf("ky")>-1?this.klevels[this.getLevel()]:this.levels[this.getLevel()]}}]),e}(),y=function(){var e="resources//audio//blib1.mp3",t=document.createElement("audio"),r=function(r){e=r||e,t.setAttribute("src",e),t.play()};return r}(),m=function(e,t){function n(){var t,I,x,q;if(!L){if(x=v/w,s=Math.abs(x-g/v*x*1.5)+x/20,i=s/l*a,g+=s,k+=i,c=m+k,h=S-g,E=g&&c>0&&c<bbShoot.constants.boardWidth-f&&h>0&&h<bbShoot.constants.boardHeight-f,C=o(e),C.length>0){var M=!0,T=!1,F=void 0;try{for(var z,_=C[Symbol.iterator]();!(M=(z=_.next()).done);M=!0)I=z.value,I.color===e.color?(B++,b.removeBubble(I),d.score++,y("resources/audio/blib1.mp3"),q=new CustomEvent("sbScoreEvt",{detail:{val:d.score}}),bbShoot.scoreBoard.sprite.dispatchEvent(q)):r(e)&&(L=!0,u(e),d.stopGame())}catch(H){T=!0,F=H}finally{try{!M&&_["return"]&&_["return"]()}finally{if(T)throw F}}}B&&b.removeBubble(e),!E||C.length?(t=b.findBubbleRow(e).row,b.setBubbleRow(e,t),e.makeNormal()):(p.style.left=m+k+"px",p.style.top=S-g+"px",requestAnimationFrame(n))}}var i,s,a,l,c,h,p=e.getSprite(),f=bbShoot.constants.bubbleSize,v=bbShoot.constants.boardHeight,S=parseInt(getComputedStyle(p).top),m=parseInt(getComputedStyle(p).left),w=40,g=0,k=0,C=[],B=0,E=!1,L=!1;l=S-t.top+f/2,a=t.left-m-f/2,w=d.gSettings.steps,n(),e.getSprite().onclick=null};document.querySelector("#startButton").onclick=c,document.querySelector("#playerNameIn").onkeydown=function(e){13===e.keyCode&&c()},document.querySelector("#test1").onclick=h}(bbShoot);